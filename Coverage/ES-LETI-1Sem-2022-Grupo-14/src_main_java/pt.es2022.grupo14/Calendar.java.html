<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="pt"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../../jacoco-resources/report.gif" type="image/gif"/><title>Calendar.java</title><link rel="stylesheet" href="../../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../../index.html" class="el_report">Main (2) (02/11/2022 13:16:31)</a> &gt; <a href="../../index.html" class="el_group">ES-LETI-1Sem-2022-Grupo-14</a> &gt; <a href="../index.html" class="el_bundle">src/main/java</a> &gt; <a href="index.source.html" class="el_package">pt.es2022.grupo14</a> &gt; <span class="el_source">Calendar.java</span></div><h1>Calendar.java</h1><pre class="source lang-java linenums">package pt.es2022.grupo14;

import java.awt.Color;
import java.awt.Font;
import java.awt.Graphics;
import java.awt.Graphics2D;
import java.awt.RenderingHints;
import java.awt.geom.Line2D;
import java.awt.geom.Rectangle2D;
import java.time.DayOfWeek;
import java.time.LocalDate;
import java.time.LocalTime;
import java.time.format.TextStyle;
import java.util.ArrayList;
import java.util.Locale;

import javax.swing.JComponent;

public abstract class Calendar extends JComponent {
	
<span class="fc" id="L21">    static LocalTime START_TIME = LocalTime.of(8, 0);</span>
<span class="fc" id="L22">    static LocalTime END_TIME = LocalTime.of(22, 30);</span>

    static final int MIN_WIDTH = 600;
    static final int MIN_HEIGHT = 600;

    static final int HEADER_HEIGHT = 30;
    static final int TIME_COL_WIDTH = 100;

<span class="fc" id="L30">    private static final int FONT_LETTER_PIXEL_WIDTH = 7;</span>
    private ArrayList&lt;CalendarEvent&gt; events;
    private double timeScale;
    private double dayWidth;
    private Graphics2D g2;
    
<span class="fc" id="L36">    private boolean darkMode = false;</span>

    /*public Calendar() {
        this(new ArrayList&lt;&gt;());
    }*/

<span class="fc" id="L42">    Calendar(ArrayList&lt;CalendarEvent&gt; events) {</span>
<span class="fc" id="L43">        this.events = events;</span>
<span class="fc" id="L44">    }</span>
    
    /*public void setStartTime(LocalTime ST_Time) {
    	START_TIME = ST_Time;
    }*/
    
    /*public void setEndTime(LocalTime END_Time) {
    	END_TIME = END_Time;
    }*/

    /*public static LocalTime roundTime(LocalTime time, int minutes) {
        LocalTime t = time;

        if (t.getMinute() % minutes &gt; minutes / 2) {
            t = t.plusMinutes(minutes - (t.getMinute() % minutes));
        } else if (t.getMinute() % minutes &lt; minutes / 2) {
            t = t.minusMinutes(t.getMinute() % minutes);
        }

        return t;
    }*/

    protected abstract boolean dateInRange(LocalDate date);

    protected abstract LocalDate getDateFromDay(DayOfWeek day);

    private void calculateScaleVars() {
<span class="fc" id="L71">        int width = getWidth();</span>
<span class="fc" id="L72">        int height = getHeight();</span>

<span class="pc bpc" id="L74" title="1 of 2 branches missed.">        if (width &lt; MIN_WIDTH) {</span>
<span class="nc" id="L75">            width = MIN_WIDTH;</span>
        }

<span class="pc bpc" id="L78" title="1 of 2 branches missed.">        if (height &lt; MIN_HEIGHT) {</span>
<span class="nc" id="L79">            height = MIN_HEIGHT;</span>
        }

<span class="fc" id="L82">        timeScale = (double) (height - HEADER_HEIGHT) / (END_TIME.toSecondOfDay() - START_TIME.toSecondOfDay());</span>
<span class="fc" id="L83">        dayWidth = (width - TIME_COL_WIDTH) / (double) numDaysToShow();</span>
<span class="fc" id="L84">    }</span>

    protected abstract int numDaysToShow();

    protected abstract double dayToPixel(DayOfWeek dayOfWeek);

    private double timeToPixel(LocalTime time) {
<span class="fc" id="L91">        return ((time.toSecondOfDay() - START_TIME.toSecondOfDay()) * timeScale) + HEADER_HEIGHT;</span>
    }

    @Override
    protected void paintComponent(Graphics g) {
<span class="fc" id="L96">        calculateScaleVars();</span>
<span class="fc" id="L97">        g2 = (Graphics2D) g;</span>

<span class="fc" id="L99">        g2.setRenderingHint(RenderingHints.KEY_ANTIALIASING, RenderingHints.VALUE_ANTIALIAS_ON);</span>
        
<span class="fc bfc" id="L101" title="All 2 branches covered.">        if(darkMode) {</span>
<span class="fc" id="L102">        	g2.setColor(Color.black);</span>
<span class="fc" id="L103">        } else {</span>
<span class="fc" id="L104">        	g2.setColor(Color.white);</span>
        }
        
<span class="fc" id="L107">        g2.fillRect(0, 0, getWidth(), getHeight());</span>

<span class="fc bfc" id="L109" title="All 2 branches covered.">        if(darkMode) {</span>
<span class="fc" id="L110">            g2.setColor(Color.white);</span>
<span class="fc" id="L111">        } else {</span>
<span class="fc" id="L112">        	g2.setColor(Color.black);</span>
    	}

<span class="fc" id="L115">        drawDayHeadings();</span>
<span class="fc" id="L116">        drawTodayShade();</span>
<span class="fc" id="L117">        drawGrid();</span>
<span class="fc" id="L118">        drawTimes();</span>

<span class="fc" id="L120">        g2.setColor(Color.black);</span>
<span class="fc" id="L121">        drawEvents();</span>
<span class="fc" id="L122">    }</span>
    
    public void changeColor() {
<span class="fc bfc" id="L125" title="All 2 branches covered.">    	darkMode = !darkMode;</span>
<span class="fc" id="L126">    	repaint();</span>
<span class="fc" id="L127">    }</span>

    protected abstract DayOfWeek getStartDay();

    protected abstract DayOfWeek getEndDay();

    private void drawDayHeadings() {
<span class="fc" id="L134">        int y = 20;</span>
        int x;
        LocalDate day;
        DayOfWeek dayOfWeek;

<span class="fc bfc" id="L139" title="All 2 branches covered.">        for (int i = 0; i &lt;= getEndDay().getValue(); i++) {</span>
<span class="fc bfc" id="L140" title="All 2 branches covered.">        	if (i != 0) {</span>
<span class="fc" id="L141">            dayOfWeek = DayOfWeek.of(i);</span>
<span class="fc" id="L142">            day = getDateFromDay(dayOfWeek);</span>

<span class="fc" id="L144">            String text = dayOfWeek.getDisplayName(TextStyle.FULL, Locale.ENGLISH);</span>
<span class="fc" id="L145">            x = (int) (dayToPixel(DayOfWeek.of(i)) + (dayWidth / 2) - (FONT_LETTER_PIXEL_WIDTH * text.length() / 2));</span>
<span class="fc" id="L146">            g2.drawString(text, x, y - 6);</span>
            
<span class="fc" id="L148">            text = day.getDayOfMonth() + &quot;/&quot; + day.getMonthValue() + &quot;/&quot; + day.getYear();</span>
<span class="fc" id="L149">            x = (int) (dayToPixel(DayOfWeek.of(i)) + (dayWidth / 2) - (FONT_LETTER_PIXEL_WIDTH * text.length() / 2));</span>
<span class="fc" id="L150">            g2.drawString(text, x, y + 6);</span>
<span class="fc" id="L151">        	}</span>
        	else {
<span class="fc" id="L153">                String text = &quot;Hours/Days&quot;;</span>
<span class="fc" id="L154">                x = FONT_LETTER_PIXEL_WIDTH * text.length() / 2;</span>
<span class="fc" id="L155">                g2.drawString(text, x - 20, y);</span>
        	}
        }
<span class="fc" id="L158">    }</span>

    private void drawGrid() {

<span class="fc" id="L162">        final Color ORIG_COLOUR = g2.getColor();</span>

<span class="fc" id="L164">        Color alphaGray = new Color(128, 128, 128, 128);</span>
<span class="fc" id="L165">        Color alphaGrayLighter = new Color(200, 200, 200, 128);</span>
<span class="fc" id="L166">        g2.setColor(alphaGray);</span>

        double x;
<span class="fc bfc" id="L169" title="All 2 branches covered.">        for (int i = getStartDay().getValue(); i &lt;= getEndDay().getValue(); i++) {</span>
<span class="fc" id="L170">            x = dayToPixel(DayOfWeek.of(i));</span>
<span class="fc" id="L171">            g2.draw(new Line2D.Double(x, HEADER_HEIGHT - 30, x, timeToPixel(END_TIME)));</span>
        }

        double y;
<span class="fc" id="L175">        int x1 = 0;</span>
<span class="fc bfc" id="L176" title="All 2 branches covered.">        for (LocalTime time = START_TIME; time.compareTo(END_TIME) &lt;= 0; time = time.plusMinutes(30)) {</span>
<span class="fc" id="L177">            y = timeToPixel(time);</span>
<span class="fc bfc" id="L178" title="All 2 branches covered.">            if (time.getMinute() == 0) {</span>
<span class="fc" id="L179">                g2.setColor(alphaGray);</span>
<span class="fc" id="L180">            } else {</span>
<span class="fc" id="L181">                g2.setColor(alphaGrayLighter);</span>
            }
<span class="fc" id="L183">            g2.draw(new Line2D.Double(x1, y, dayToPixel(getEndDay()) + dayWidth, y));</span>
        }

<span class="fc" id="L186">        g2.setColor(ORIG_COLOUR);</span>
<span class="fc" id="L187">    }</span>

    private void drawTodayShade() {
<span class="fc" id="L190">        LocalDate today = LocalDate.now();</span>

<span class="fc bfc" id="L192" title="All 2 branches covered.">        if (!dateInRange(today)) return;</span>

<span class="fc" id="L194">        final double x = dayToPixel(today.getDayOfWeek());</span>
<span class="fc" id="L195">        final double y = timeToPixel(START_TIME);</span>
<span class="fc" id="L196">        final double width = dayWidth;</span>
<span class="fc" id="L197">        final double height = timeToPixel(END_TIME) - timeToPixel(START_TIME);</span>

<span class="fc" id="L199">        final Color origColor = g2.getColor();</span>
<span class="fc" id="L200">        Color alphaGray = new Color(200, 200, 200, 64);</span>
<span class="fc" id="L201">        g2.setColor(alphaGray);</span>
<span class="fc" id="L202">        g2.fill(new Rectangle2D.Double(x, y, width, height));</span>
<span class="fc" id="L203">        g2.setColor(origColor);</span>
<span class="fc" id="L204">    }</span>

    private void drawTimes() {
        int y;
<span class="fc bfc" id="L208" title="All 2 branches covered.">        for (LocalTime time = START_TIME; time.compareTo(END_TIME) &lt;= 0; time = time.plusMinutes(30)) {</span>
<span class="fc" id="L209">            y = (int) timeToPixel(time) + 25;</span>
<span class="fc" id="L210">            g2.drawString((time + &quot;-&quot; + time.plusMinutes(30).toString()), TIME_COL_WIDTH - (FONT_LETTER_PIXEL_WIDTH * time.toString().length()) - 50, y);</span>
        }
<span class="fc" id="L212">    }</span>

    private void drawEvents() {
        double x;
        double y0;

<span class="fc bfc" id="L218" title="All 2 branches covered.">        for (CalendarEvent event : events) {</span>
<span class="fc bfc" id="L219" title="All 2 branches covered.">            if (!dateInRange(event.getDate())) continue;</span>

<span class="fc" id="L221">            x = dayToPixel(event.getDate().getDayOfWeek());</span>
<span class="fc" id="L222">            y0 = timeToPixel(event.getStart());</span>

<span class="fc" id="L224">            Rectangle2D rect = new Rectangle2D.Double(x, y0, dayWidth, (timeToPixel(event.getEnd()) - timeToPixel(event.getStart())));</span>
<span class="fc" id="L225">            Color origColor = g2.getColor();</span>
<span class="fc" id="L226">            g2.setColor(event.getColor());</span>
<span class="fc" id="L227">            g2.fill(rect);</span>
<span class="fc" id="L228">            g2.setColor(origColor);</span>

<span class="fc" id="L230">            Font origFont = g2.getFont();</span>

<span class="fc" id="L232">            final float fontSize = origFont.getSize() - 1.6F;</span>

<span class="fc" id="L234">            Font newFont = origFont.deriveFont(Font.BOLD, fontSize);</span>
<span class="fc" id="L235">            g2.setFont(newFont);</span>

<span class="fc" id="L237">            g2.drawString(event.getStart() + &quot; - &quot; + event.getEnd(), (int) x + 5, (int) y0 + 11);</span>

<span class="fc" id="L239">            g2.setFont(origFont.deriveFont(fontSize));</span>

<span class="fc" id="L241">            String text = event.getText();</span>

<span class="pc bpc" id="L243" title="1 of 2 branches missed.">            for (int i = 0; i &lt; 10; i++)</span>
            {
<span class="fc" id="L245">                int toCut = cutString(text);</span>
<span class="fc" id="L246">                String toPrint = text.substring(0, toCut);</span>
<span class="fc" id="L247">                g2.drawString(toPrint, (int) x + 5, (int) y0 + 23 + 11*i);</span>

<span class="fc bfc" id="L249" title="All 2 branches covered.">                if (toCut == 0) break;</span>

<span class="fc" id="L251">                text = text.substring(toCut).strip();</span>
            }

<span class="fc" id="L254">            g2.setFont(origFont);</span>
        }
<span class="fc" id="L256">    }</span>

    private int cutString(String text)
    {
<span class="fc" id="L260">        String lastString = &quot;&quot;;</span>
<span class="fc bfc" id="L261" title="All 2 branches covered.">        for (String cut : text.split(&quot; &quot;))</span>
        {
<span class="fc bfc" id="L263" title="All 2 branches covered.">            if (g2.getFontMetrics().stringWidth((lastString +  &quot; &quot; + cut)) &lt; dayWidth)</span>
            {
<span class="fc" id="L265">                lastString += &quot; &quot; + cut;</span>
            }
            else break;
        }

<span class="fc" id="L270">        return lastString.length() - 1;</span>
    }

    protected double getDayWidth() {
<span class="fc" id="L274">        return dayWidth;</span>
    }

    protected abstract void setRangeToToday();

    public void goToToday() {
<span class="fc" id="L280">        setRangeToToday();</span>
<span class="fc" id="L281">        repaint();</span>
<span class="fc" id="L282">    }</span>

    /*public void addEvent(CalendarEvent event) {
        events.add(event);
        repaint();
    }*/

    /*public boolean removeEvent(CalendarEvent event) {
        boolean removed = events.remove(event);
        repaint();
        return removed;
    }*/

    public void setEvents(ArrayList&lt;CalendarEvent&gt; events) {
<span class="fc" id="L296">        this.events = events;</span>
<span class="fc" id="L297">        repaint();</span>
<span class="fc" id="L298">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span>Main (2) (02/11/2022 13:16:31)</div></body></html>